<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="Image/Index/favicon.png" type="image/png">
    <title>Gi·ªè h√†ng</title>
    <link rel="stylesheet" href="Giohang.css">
    <script src="jquery-3.7.1.min.js"></script> 
    <script src="Giohang.js"></script>
    <script>$(document).ready(function() {
        $("#header").load("header.html", function() {
            updateCartCount(); // G·ªçi h√†m sau khi header.html ƒë∆∞·ª£c t·∫£i
            });
        });
        </script>

    </script>
    <!-- <script src="Giohang.css"></script> -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Retrieve the productOrders from localStorage
            const productOrders = JSON.parse(localStorage.getItem('productOrders')) || [];
        
            // Merge items with the same name
            const mergedOrders = productOrders.reduce((acc, product) => {
                const existingProduct = acc.find(item => item.name === product.name);
                if (existingProduct) {
                    existingProduct.quantity += product.quantity;
                } else {
                    acc.push({ ...product });
                }
                return acc;
            }, []);
        
            // Function to format price
            function formatPrice(price) {
                return parseInt(price.replace(/[^0-9]/g, ''), 10);
            }
        
            // Function to update total price
            function updateTotalPrice() {
                const total = Array.from(document.querySelectorAll('.total-column'))
                    .reduce((sum, totalColumn) => {
                        return sum + formatPrice(totalColumn.innerText);
                    }, 0);
                document.getElementById('totalPrice').innerText = total.toLocaleString() + '‚Ç´';
            }
        
            // Function to create a cart item element
            function createCartItem(product) {
                const price = formatPrice(product.price);
                const quantity = product.quantity;
                const total = price * quantity;
        
                const cartItem = document.createElement('div');
                cartItem.classList.add('cart-item');
                cartItem.innerHTML = `
                    <div class="product-column">
                        <img src="${product.photo}" alt="${product.name}">
                    </div>
                    <div class="description-column">${product.name}</div>
                    <div class="price-column">${product.price}</div>
                    <div class="quantity-column">
                        <input type="number" value="${quantity}" min="1">
                    </div>
                    <div class="total-column">${total.toLocaleString()}‚Ç´</div>
                    <div class="remove-column">
                        <button>üóëÔ∏è</button>
                    </div>
                `;
        
                // Event listener to update total when quantity changes
                const quantityInput = cartItem.querySelector('.quantity-column input');
                quantityInput.addEventListener('input', (event) => {
                    const newQuantity = parseInt(event.target.value, 10);
                    if (isNaN(newQuantity) || newQuantity < 1) {
                        event.target.value = quantity;
                        return;
                    }
                    product.quantity = newQuantity;
                    const newTotal = price * newQuantity;
                    cartItem.querySelector('.total-column').innerText = newTotal.toLocaleString() + '‚Ç´';
                    updateTotalPrice();
                    localStorage.setItem('productOrders', JSON.stringify(mergedOrders));
                });
        
                // Event listener to remove item
                const removeButton = cartItem.querySelector('.remove-column button');
                removeButton.addEventListener('click', () => {
                    const index = mergedOrders.findIndex(item => item.name === product.name);
                    if (index !== -1) {
                        mergedOrders.splice(index, 1);
                        cartItem.remove();
                        updateTotalPrice();
                        localStorage.setItem('productOrders', JSON.stringify(mergedOrders));
                    }
                });
        
                return cartItem;
            }
        
            // Get the cartItems container
            const cartItemsContainer = document.getElementById('cartItems');
        
            // Generate cart items
            mergedOrders.forEach(product => {
                const cartItem = createCartItem(product);
                cartItemsContainer.appendChild(cartItem);
            });
        
            // Update the total price initially
            updateTotalPrice();
        
            // Save merged orders back to localStorage
            localStorage.setItem('productOrders', JSON.stringify(mergedOrders));
        });
        </script>
        
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
        const emptyCart = document.getElementById("emptyCart");
        const cartContent = document.getElementById("cartContent");

        // L·∫•y s·ªë l∆∞·ª£ng s·∫£n ph·∫©m t·ª´ localStorage (ho·∫∑c 0 n·∫øu ch∆∞a c√≥)
        const cartItemCount = parseInt(localStorage.getItem("cartCount")) || 0;

        // Ki·ªÉm tra s·ªë l∆∞·ª£ng v√† c·∫≠p nh·∫≠t hi·ªÉn th·ªã
        if (cartItemCount === 0) {
            emptyCart.style.display = "block";
            cartContent.style.display = "none";
        } else {
            emptyCart.style.display = "none";
            cartContent.style.display = "block";
        }
    });

    </script>

</head>
<body>
    <div id="header"></div> 
    <script>
    fetch('header.html')
        .then(response => response.text())
        .then(data => {
        document.getElementById('header').innerHTML = data;
        });

    </script>

    <div id="cart-list-item">
        <h2>GI·ªé H√ÄNG</h2>

        <div id="emptyCart">
            <img src="Image/cart/cart-empty.png" alt="Gi·ªè h√†ng tr·ªëng"> 
            <p>Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o trong gi·ªè h√†ng c·ªßa b·∫°n</p>
            <a href="index.html" id="continueShopping">TI·∫æP T·ª§C MUA H√ÄNG</a>

        </div>

        <div id="cartContent">       
            <div id="cartContent">
                <div class="cart-header">
                    <span class="product-column">S·∫£n ph·∫©m</span>
                    <span class="description-column">M√¥ T·∫£</span>
                    <span class="price-column">Gi√°</span>
                    <span class="quantity-column">S·ªë L∆∞·ª£ng</span>
                    <span class="total-column">T·ªïng</span>
                    <span class="remove-column">X√≥a</span>
                </div>
            
                <div id="cartItems">
                    <!-- Items will be dynamically generated here -->
                </div> 
            
                <div class="cart-footer">
                    <div class="total-price">
                        T·ªïng: <span id="totalPrice">0‚Ç´</span>
                    </div>
                    <div class="cart-actions">
                        <button id="continueShopping">TI·∫æP T·ª§C MUA S·∫ÆM</button>
                        <button id="checkout">THANH TO√ÅN</button>
                    </div>
                </div>
                
                <div id="notes">
                    <h3>Ch√∫ Th√≠ch</h3>
                    <textarea placeholder="B·∫°n mu·ªën m√¥ t·∫£ r√µ h∆°n v·ªÅ ƒë∆°n h√†ng..."></textarea>
                </div>
                <div id="installmentOption">
                    <h3>MUA TR·∫¢ G√ìP QUA TH·∫∫ T√çN D·ª§NG</h3>
                    <div>
                        <input type="radio" id="installmentOption1" name="installmentOption" checked>
                        <label for="installmentOption1">
                            Ch·ªçn h√¨nh th·ª©c: Thanh to√°n th·∫ª - Tr·∫£ g√≥p (L∆∞u √Ω: LH nh√¢n vi√™n ƒë·ªÉ ki·ªÉm tra t·ªìn kho s·∫£n ph·∫©m tr∆∞·ªõc khi thanh to√°n)
                        </label>
                    </div>
                    <div>
                        <input type="radio" id="installmentOption2" name="installmentOption">
                        <label for="installmentOption2">
                            Ch·ªçn lo·∫°i th·∫ª ph√π h·ª£p v·ªõi nhu c·∫ßu, nh·∫≠p th√¥ng tin, sau ƒë√≥ ti·∫øn h√†nh thanh to√°n
                        </label>
                    </div>
                </div>
            </div>
            
            
            
        </div>
        

    </div>
    <script src="script.js"></script> 
    
    <div id="footer"></div>
    <script>
        
    fetch('footer.html')
        .then(response => response.text())
        .then(data => {
        document.getElementById('footer').innerHTML = data;
        });
    </script>
</body>
</html>